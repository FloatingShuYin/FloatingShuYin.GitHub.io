---
title: HTTP与AJAX
date: 2017-12-13 16:19:35
tags:
- 笔记
- HTTP
- AJAX
categories:
- 笔记
- HTTP与AJAX
---

- 来自runoob的[runoob菜鸟AJAX教程](http://www.runoob.com/ajax/ajax-tutorial.html)
- 来自W3cshool的[jQuery ajax 教程](http://www.w3school.com.cn/jquery/ajax_ajax.asp)
- 来自W3cshool的[jQuery 参考手册 - Ajax](http://www.w3school.com.cn/jquery/jquery_ref_ajax.asp)

## 超文本传输协议（HTTP，HyperText Transfer Protocol)

### HTTP请求与响应

一个完整HTTP通信过程通常有以下7个步骤

1. 建立TCP连接
2. Web浏览器向Web服务器发送请求命令
3. Web浏览器发送请求头信息
4. Web服务器应答
5. Web服务器发送应答头信息
6. Web服务器向浏览器发送数据
7. Web服务器关闭TCP连接

#### **HTTP请求**

一个HTTP请求一般由四部分组成

1. HTTP请求的方法或动作(GET/POST)
2. 正在请求的统一资源标示符（URL,Uniform Resource Identifiers）
3. 请求头,包含一些客户端环境信息,身份验证信息等
4. 请求体,也就是请求正文,请求正文中可以包含客户提交的查询字符串信息,表单信息等等.
<!-- more -->
##### **Get提交与POST提交**

- GET:一般用于信息获取,使用URL传参,对所发送信息的数量也有限制,一般在2000个字符.

- POST:一般用于修改服务器上的资源.对所发送信息的数量无限制.


**GET 还是 POST？**

与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用。

然而，在以下情况中，请使用 POST 请求：
 - 无法使用缓存文件（更新服务器上的文件或数据库）
 - 向服务器发送大量数据（POST 没有数据量限制）
 - 发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠


#### **HTTP响应**

一个HTTP响应一般由三部份组成

1. 一个数字和文字组成的状态码,用来显示请求是成功还是失败
2. 响应头,响应头也和请求头一样包含许多有用的信息,例如服务器类型＼日期时间＼内容类型＼长度等
3. 响应体，也就是响应正文

##### **http 状态码**

http 状态码由3位数字构成,其中首位数字定义了状态码的类型

1XX 信息类 表示收到web浏览器请求,正在进一步处理中
2xx 成功,表示用户请求被正确接收,理解和处理 例如: 200 OK
3xx 重定向，表示请求没有成功，客户必须采取进一步的动作
4xx 客户端错误,表示客户端提交的请求有错误,例如:400 NOT Found
5xx 服务器错误，表示服务器不能完成对请求的处理.例如: 500


## AJAX (Asynchronous Javascript And XML)（异步 JavaScript 和 XML)

- AJAX 最大的优点是在不重新加载整个页面的情况下，可以与服务器交换数据并更新部分网页内容。
- AJAX 不需要任何浏览器插件，但需要用户允许JavaScript在浏览器上执行。

### XMLHttpRequest 对象

- 所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 ``XMLHttpRequest`` 对象。（IE5 和 IE6 使用 ActiveXObject）。

#### **创建 XMLHttpRequest 对象**

创建 XMLHttpRequest 对象的语法：
``variable=new XMLHttpRequest();``

老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象：
``variable=new ActiveXObject("Microsoft.XMLHTTP");``

为了应对所有的现代浏览器，包括 IE5 和 IE6，请检查浏览器是否支持 ``XMLHttpRequest`` 对象。如果支持，则创建 ``XMLHttpRequest`` 对象。如果不支持，则创建 ActiveXObject ：

```js
var xmlhttp;
if (window.XMLHttpRequest)
{
    //  IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
    xmlhttp=new XMLHttpRequest();
}
else
{
    // IE6, IE5 浏览器执行代码
    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
}
```

#### **向服务器发送请求**

如需将请求发送到服务器，我们使用 ``XMLHttpRequest`` 对象的 ``open()`` 和 ``send()`` 方法：

``open(method,url,async)``
规定请求的类型、URL 以及是否异步处理请求。

- method：请求的类型；GET 或 POST
- url：文件在服务器上的位置
- async：true（异步）或 false（同步）

``send(string)``
将请求发送到服务器。

- string：仅用于 POST 请求

``setRequestHeader(header,value)``
向请求添加 HTTP 头。

- header: 规定头的名称
- value: 规定头的值


实例

```js

xmlhttp.open("POST","/try/ajax/demo_post2.php",true);
xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
xmlhttp.send("fname=Henry&lname=Ford");

```

#### **服务器响应**

如需获得来自服务器的响应，请使用 XMLHttpRequest 对象的 responseText 或 responseXML 属性。

``responseText`` 	
- 获得字符串形式的响应数据。
 ``responseXML`` 	
 - 获得 XML 形式的响应数据。

### onreadystatechange 事件

当请求被发送到服务器时，我们需要执行一些基于响应的任务。
每当 readyState 改变时，就会触发 onreadystatechange 事件。
readyState 属性存有 XMLHttpRequest 的状态信息。

``onreadystatechange``
 	存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。

``readyState ``
存有 XMLHttpRequest 的状态。从 0 到 4 发生变化。

  -  0: 请求未初始化
  -  1: 服务器连接已建立
  -  2: 请求已接收
  -  3: 请求处理中
  -  4: 请求已完成，且响应已就绪

``status``
- 200: "OK"
- 404: 未找到页面

在 onreadystatechange 事件中，我们规定当服务器响应已做好被处理的准备时所执行的任务。
当 readyState 等于 4 且状态为 200 时，表示响应已就绪：

```JS
xmlhttp.onreadystatechange=function()
{
    if (xmlhttp.readyState==4 && xmlhttp.status==200)
    {
        document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
    }
}
```

### [Jquery对AJAX的封装](http://www.w3school.com.cn/jquery/ajax_ajax.asp)

- 直接点击去看原文,不能再简洁了.

### 实例

- 因为AJAX需要与服务器交互,所以需要选择一门后端语言,推荐运行在node.js平台上的JavaScript.

#### 原生JavaScript实例

- [这是模仿runoob.com的一个实例](http://www.runoob.com/try/try.php?filename=tryajax_suggest)

- 需要自行[搭建node.js的开发环境](http://www.runoob.com/nodejs/nodejs-install-setup.html),这很简单.

- 浏览器端的index.html代码如下(来自runoob.com,稍作修改):

```html
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<script>
// 定义showHint()函数,只接受一个参.
function showHint(str)
{
    console.log('nice');
  // 放弃兼容IE5\6 直接创建XMLHttpRequest实例对象:xmlhttp
  var xmlhttp = new XMLHttpRequest();

  if (str.length === 0)
  {
    // 如果没传参过来(空的文本框)
    document.getElementById("txtHint").innerHTML="";
    // 退出函数
    return;
  }
  // 监听onreadystatechange事件
  xmlhttp.onreadystatechange=function()
  {
    if (xmlhttp.readyState === 4 && xmlhttp.status === 200)
    {
      // 如果服务器已成功受理我们的请求,那么我们就将服务器返回的数据填进去
      document.getElementById("txtHint").innerHTML=xmlhttp.responseText;
      console.log('nice');
    }
  }
  // 定义一些参数:提交方式\URL\是否异步
  xmlhttp.open("GET","http://127.0.0.1:8888?q="+str,true);
  // 发送给服务器
  xmlhttp.send();
}
</script>
</head>
<body>

<h3>在输入框中尝试输入字母 a:</h3>
<form action="">
<!-- 很简单的一个表单,给一个文本框组件添加了一个 onkeyup 事件,而onkeyup 事件触发showHint()函数 并且将文本框内容作为参数传进去-->
输入姓名: <input type="text" id="txt1" onkeyup="showHint(this.value)" />
</form>
<p>提示信息: <span id="txtHint"></span></p>

</body>
</html>
```

- 服务器端的 node.js 代码如下:

```js
/* 先引入一些nodejs模块
(可以将模块理解为一个个jquery,nodejs语言的开发者封装了一些基层代码
为我们提供了API)*/
var http = require('http');
var url = require('url');

// 调用http模块中的createServer()函数,顾名思义:创建一个服务进程
/*
 *request:请求
 *response:响应
 */
http.createServer(function (request, response) {
    // 发送 HTTP 头部
    // HTTP 状态值: 200 : OK
    // 内容类型: text/plain
    // 'Access-Control-Allow-Origin': '*' 允许跨域访问(HTML5特性)
    response.writeHead(200, {'Content-Type': 'text/plain','Access-Control-Allow-Origin': '*'});
    // 调用url的parse()函数,为了得到浏览器端url中传的参数
    /*
     *q =>{ q: 'str'}
     */
    var q = url.parse(request.url, true).query;
    //var q = url.parse('http://localhost:8888/select?q=a', true).query;
    console.log(q);
    // 字符串数组
    var list = ['Anna','Brittany','Cinderella','Diana',
    'Eva','Fiona','Gunda','Hege','Inga','Johanna','Kitty',
    'Linda','Nina','Ophelia','Petunia','Amanda','Raquel','Cindy',
    'Doris','Eve','Evita','Sunniva','Tove','Unni','Violet','Liza',
    'Elizabeth','Ellen','WeVicky'];

    var qValue;
    for(var k in q){
    //console.log(k);   取得是key值
    //console.log(q[k]);//取得是value值
    qValue = q[k].toUpperCase();
    }
    console.log(qValue);
    var result = [];
    //
    if(qValue.length === 1){
      for(var i = 0; i < list.length; i++){
        // 遍历数组,取其首字母,进行迭代匹配.
        if(list[i].slice(0,1) === qValue){
          // 符合要求的添加到result数组中
          result.push(list[i]);
        }
      }
    }
    console.log(result.join());
    // result数组长度小于1 说明没有找到匹配的
    if(result.length < 1){
      // 发送响应数据
      response.write('no suggestion')
    }else {
      // 否则说明找到了匹配的,转为字符串响应给浏览器
      response.write(result.join());
    }

    // 响应结束
    response.end();

// 服务器监听在8888端口
}).listen(8888);

// 终端打印如下信息
console.log('Server running at http://127.0.0.1:8888/');
```

**如何使用?**
- 使用终端(cmd?) ``cd`` 到你的 server.js 文件所在目录  
- 键入 ``node server.js``
- (现代)浏览器运行 index.html
- 按提示在输入框输入内容,你可以看到提示信息,
并且可以在终端看到console.log()打印出来的信息

#### Jquery实例 ``TODO``
