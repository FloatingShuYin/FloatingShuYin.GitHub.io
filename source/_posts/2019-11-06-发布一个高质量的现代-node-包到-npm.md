---
title: 发布一个高质量的现代 node 包到 npm
date: 2019-11-06 01:39:12
tags:
- npm
- node package
- 现代
- 高质量
- 标准
---

> 愚蠢的人让神经网络像机器的硬盘一样记忆信息, 聪明的人让机器模仿学习像人类一样深邃的思考.

[代码规范与项目结构]: https://floatsyi.com/2019/09/26/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83%E4%B8%8E%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84/
[前端构建工具]: https://floatsyi.com/2019/10/06/%E5%89%8D%E7%AB%AF%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7/
[持续集成]: https://floatsyi.com/2019/11/09/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/

[eslint-config-standard]: https://github.com/standard/eslint-config-standard
[eslint]: https://github.com/eslint/eslint
[rollup]: https://www.rollupjs.org/guide/en/
[rollup/awesome]: https://github.com/rollup/awesome
[lint-staged]: https://github.com/okonet/lint-staged
[husky]: https://github.com/typicode/husky
[chalk]: https://github.com/chalk/chalk
[github]: https://github.com/

## 参考
- [代码规范与项目结构][]
- [前端构建工具][]
- [持续集成][]

## 资源
- [eslint-config-standard][]
- [eslint][]
- [rollup][]
- [rollup/awesome][]
- [lint-staged][]
- [husky][]
- [chalk][]

## 步骤

### [node-module-boilerplate][]

#### 新建一个 github 仓库, 对代码进行版本管理
1. 登录 [github][] 并新建一个名为 `node-module-boilerplate` 的仓库

2. 使用 git 命令行工具 clone 位于 github 服务器的仓库
```bash
cd x:/git.workspace/
git clone url
```
3. 使用编辑器打开工作目录
```bash
cd node-module-boilerplate
code .
```

#### 使用 npm 管理依赖

1. 初始化工作目录
```bash
 npm init
```

#### 使用 [rollup][] 构建工具, 构建现代化 node package

1. 使用 npm 添加开发时依赖: rollup
```bash
npm i rollup -D
```

2. 创建基本的目录结构
```bash
mkdir -p src/index.js __test__/index.spec.js dist rollup.config.js
```

3. 添加以下内容到 `rollup.config.js`
参考: [前端构建工具][]
```js
export default {
  input: 'src/index.js',
  output: [
    {
      file: 'dist/bundle.cjs.js',
      format: 'cjs'
    },
    {
      file: 'dist/bundle.esm.js',
      format: 'es'
    }
  ]
}
```

4. 添加以下 npm script
package.json:
```json
{
  "main": "bundle.cjs.js",
  "module": "bundle.esm.js",
  "script": {
     "build": "rollup --config"
  }
}
```


#### 使用 [eslint][] 和 [eslint-config-standard][]
参考: [代码规范与项目结构][]
1. 使用 npm 添加开发时依赖性: [eslint][] 和 [eslint-config-standard][]
```bash
npm i -D eslint
npm install --save-dev eslint-config-standard eslint-plugin-standard eslint-plugin-promise eslint-plugin-import eslint-plugin-node
```

2. 新建 `.eslintrc` 和 `.eslintignore` 文件
```bash
touch .eslintrc .eslintignore
```
  `.eslintrc`:
  ```json
  {
    "extends": "standard"
  }
  ```
  `.eslintignore`:
  ```
  dist/**
  ```

3. 添加以下 npm script
package.json:
```json
{
  "script": {
    "lint": "eslint .",
    "lint:fix": "eslint --fix ."
  }
}
```

#### 使用 [lint-staged][] , [husky][] 以及 [commitlint][] 规范 git staged files 和 git commit message
1. 使用 npm 添加开发时依赖: lint-staged \ husky \ commitlint
```bash
npm i -D husky lint-staged
npm install --save-dev @commitlint/config-angular @commitlint/cli
npm install --save-dev @commitlint/prompt @commitlint/prompt-cli
```

2. 添加以下内容到 `package.json`
package.json
```json
{
  "scripts": {
    "commit": "commit"
  },
  "lint-staged": {
    "*.js": [
      "eslint --fix",
      "git add"
    ]
  }
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged",
      "commit-msg": "commitlint -E HUSKY_GIT_PARAMS"
    }
  }
}
```

3. 添加以下内容到 `commitlint.config.js`
commitlint.config.js:
```js
module.exports = { extends: ['@commitlint/config-angular'] }
```

### [@floatsyi/Steam][]

