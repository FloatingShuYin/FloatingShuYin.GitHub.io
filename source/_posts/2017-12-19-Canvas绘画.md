---
title: Canvas绘画
date: 2017-12-19 16:07:51
tags:
- HTML5
- Canvas
categories:
- 笔记
- Canvas绘画
---

- 学习慕课网 [l1uyub0b0b0 老师的Canvas绘画课程](http://www.imooc.com/learn/133)时的笔记
- [canvas速查](http://canvas.migong.org/html5-canvas)

## Canvas

用代码来描叙画画的过程,是一件很有意思的事情.

而canvas是基于状态绘画的.

<!-- more -->
### 模板骨架

- **HTML**

```html
<canvas id="canvas" style="border:1px solid #aaa;display:block;margin:50px auto">
当前浏览器不支持canvas,请更换先进的浏览器再试
</canvas>
```

*Tips : canvas标签内部的元素将被支持canvas的浏览器忽略*

- **JavaScript**

```js
<script>
  window.onload = function(){
    var canvas = document.getElementById('canvas');

    // 指定画布大小
    canvas.width = 1366;
    canvas.height = 768;

    if(canvas.getContext){
      var ctx = canvas.getContext('2d');
      // 使用context进行绘制

    }else {
      alert('当前浏览器不支持canvas,请更换先进的浏览器再试');
    }
  }
</script>
```

- 整合在一起

```html
<html>
  <head>
    <title>Canvas tutorial</title>
    <script type="text/javascript">
      function draw(){
        var canvas = document.getElementById('tutorial');
        if (canvas.getContext){
          var ctx = canvas.getContext('2d');
        }
      }
    </script>
    <style type="text/css">
      canvas { border: 1px solid black; }
    </style>
  </head>
  <body onload="draw();">
    <canvas id="tutorial" width="150" height="150"></canvas>
  </body>
</html>
```

### arc函数

```js
/*
 * @param centerx,centery 圆心坐标
 * @param radius 半径
 * @param startingAngle,endingAngle 起始弧度值 结束弧度值
 * @param anticlockwise  是否逆时针绘制(可选的参,默认false:顺时针)
 */
ctx.arc(centerx,centery,radius,
  startingAngle,endingAngle,anticlockwise = false)  
```

![弧度参考图][弧度参考图]
[弧度参考图]: <http://oy9dwtsnx.bkt.clouddn.com/arc%E5%BC%A7%E5%BA%A6%E5%8F%82%E6%95%B0%E5%9B%BE.png> (弧度参考图)

## 实例

### 七巧板实例

<div style="clear:both"></div>
**index.html**
{% fold 点击显/隐 %}
```html
<html>
  <head>
    <title>Canvas tutorial</title>
  </head>
  <body>
  <canvas id="canvas" style="border:1px solid #aaa;display:block;margin:50px auto">
  </canvas>
  <script>
      var tangram = [
          {p:[{x:0,y:0},{x:800,y:0},{x:400,y:400}],color:'#caff67'},
          {p:[{x:0,y:0},{x:400,y:400},{x:0,y:800}],color:'#67becf'},
          {p:[{x:800,y:0},{x:800,y:400},{x:600,y:600},{x:600,y:200}],color:'#ef3d61'},
          {p:[{x:600,y:200},{x:600,y:600},{x:400,y:400}],color:'#f9f51a'},
          {p:[{x:400,y:400},{x:600,y:600},{x:400,y:800},{x:200,y:600}],color:'#a594c0'},
          {p:[{x:200,y:600},{x:400,y:800},{x:0,y:800}],color:'#fa8ecc'},
          {p:[{x:800,y:400},{x:800,y:800},{x:400,y:800}],color:'#f6ca29'}
        ]

        window.onload = function(){
            var canvas = document.getElementById('canvas');

            // 指定画布大小
            canvas.width = 800;
            canvas.height = 800;

            if(canvas.getContext('2d')){
                var ctx = canvas.getContext('2d');
                // 使用context进行绘制

                for (var i = 0; i < tangram.length; i++) {
                    draw(tangram[i],ctx);
                }

                function draw(piece,cxt) {
                    cxt.beginPath();
                    cxt.moveTo(piece.p[0].x, piece.p[0].y);
                    for (var i = 0; i < piece.p.length; i ++) {
                        cxt.lineTo(piece.p[i].x, piece.p[i].y);
                     }
                    cxt.closePath();

                    cxt.fillStyle = piece.color;
                    cxt.fill();
                }

          }else {
              alert('当前浏览器不支持canvas,请更换先进的浏览器再试');
          }
      }
  </script>
  </body>
</html>
```
{% endfold %}

### 圣诞倒计时

<div style="clear:both"></div>
**index.html**
{% fold 点击显/隐 %}
```HTML
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <canvas id="canvas" style="display:block;margin:50px auto">
        当前浏览器不支持canvas,请更换先进的浏览器再试
  </canvas>

  <script src="digit.js"></script>
  <script src="countdown.js"></script>
</body>
</html>
```
{% endfold %}
**digit.js**
{% fold 点击显/隐 %}
```js
digit =
    [
        [
            [0,0,1,1,1,0,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,0,1,1,0],
            [0,0,1,1,1,0,0]
        ],//0
        [
            [0,0,0,1,1,0,0],
            [0,1,1,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [1,1,1,1,1,1,1]
        ],//1
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,1,1],
            [1,1,1,1,1,1,1]
        ],//2
        [
            [1,1,1,1,1,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,1,0,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//3
        [
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,0],
            [0,0,1,1,1,1,0],
            [0,1,1,0,1,1,0],
            [1,1,0,0,1,1,0],
            [1,1,1,1,1,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,1,1]
        ],//4
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,1,1,1,1,0],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//5
        [
            [0,0,0,0,1,1,0],
            [0,0,1,1,0,0,0],
            [0,1,1,0,0,0,0],
            [1,1,0,0,0,0,0],
            [1,1,0,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//6
        [
            [1,1,1,1,1,1,1],
            [1,1,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,0,0,1,1,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0],
            [0,0,1,1,0,0,0]
        ],//7
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,1,1,0]
        ],//8
        [
            [0,1,1,1,1,1,0],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [1,1,0,0,0,1,1],
            [0,1,1,1,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,0,1,1],
            [0,0,0,0,1,1,0],
            [0,0,0,1,1,0,0],
            [0,1,1,0,0,0,0]
        ],//9
        [
            [0,0,0,0],
            [0,0,0,0],
            [0,1,1,0],
            [0,1,1,0],
            [0,0,0,0],
            [0,0,0,0],
            [0,1,1,0],
            [0,1,1,0],
            [0,0,0,0],
            [0,0,0,0]
        ]//:
    ];
```
{% endfold %}
**countdown.js**
{% fold 点击显/隐 %}
```js
var WINDOW_WIDTH;
var WINDOW_HEIGHT;

// 小圆半径
var RADIUS;

// 边距
var MARGIN_LEFT;
var MARGIN_TOP;

// 设置截止时间

const endTime = new Date(2017,11,25,00,00,00);

// 或指定时间

// const endTime = new Date();
// endTime.setTime( endTime.getTime() + 3600*1000 )

var curShowTimeSeconds = 0;

// 小球数组
var balls = [];
// 小球颜色数组
const colors = ["#33B5E5","#0099CC","#AA66CC","#9933CC","#99CC00","#669900","#FFBB33","#FF8800","#FF4444","#CC0000"];
window.onload = function () {

    WINDOW_WIDTH = window.screen.width;
    WINDOW_HEIGHT = window.screen.height ;

  // 小圆半径
    RADIUS = Math.round(WINDOW_WIDTH*4/5/108) - 1;

  // 边距
    MARGIN_LEFT = Math.round(WINDOW_WIDTH/10);
    MARGIN_TOP = Math.round(WINDOW_HEIGHT/5);

    var canvas = document.getElementById('canvas');
    var ctx = canvas.getContext('2d');

    canvas.width = WINDOW_WIDTH;
    canvas.height = WINDOW_HEIGHT;

    curShowTimeSeconds = getCurrentShowTimeSeconds();

    setInterval(
      function () {
        render(ctx);
        update();
      }
      ,
      50
    );

}

function getCurrentShowTimeSeconds() {
    var curTime = new Date();

    // 倒计时
    var ret = endTime.getTime() - curTime.getTime();
    ret = Math.round(ret/1000);

    return ret >= 0 ? ret : 0;

    // 或时针
    // var ret = curTime.getHours() * 3600 + curTime.getMinutes() * 60 + curTime.getSeconds();
    // return ret;
}

function update() {
    var nextShowTimeSeconds = getCurrentShowTimeSeconds();

    var nextHours = parseInt(nextShowTimeSeconds/3600);
    var nextMinutes = parseInt((nextShowTimeSeconds - nextHours*3600)/60);
    var nextSeconds = nextShowTimeSeconds%60;

    var curHours = parseInt(curShowTimeSeconds/3600);
    var curMinutes = parseInt((curShowTimeSeconds - curHours*3600)/60);
    var curSeconds = curShowTimeSeconds%60;

    if(nextSeconds !== curSeconds){
        if( parseInt(curHours/10) != parseInt(nextHours/10) ){
            addBalls( MARGIN_LEFT + 0 , MARGIN_TOP , parseInt(curHours/10) );
        }
        if( parseInt(curHours%10) != parseInt(nextHours%10) ){
            addBalls( MARGIN_LEFT + 15*(RADIUS+1) , MARGIN_TOP , parseInt(curHours/10) );
        }

        if( parseInt(curMinutes/10) != parseInt(nextMinutes/10) ){
            addBalls( MARGIN_LEFT + 39*(RADIUS+1) , MARGIN_TOP , parseInt(curMinutes/10) );
        }
        if( parseInt(curMinutes%10) != parseInt(nextMinutes%10) ){
            addBalls( MARGIN_LEFT + 54*(RADIUS+1) , MARGIN_TOP , parseInt(curMinutes%10) );
        }

        if( parseInt(curSeconds/10) != parseInt(nextSeconds/10) ){
            addBalls( MARGIN_LEFT + 78*(RADIUS+1) , MARGIN_TOP , parseInt(curSeconds/10) );
        }
        if( parseInt(curSeconds%10) != parseInt(nextSeconds%10) ){
            addBalls( MARGIN_LEFT + 93*(RADIUS+1) , MARGIN_TOP , parseInt(nextSeconds%10) );
        }
        curShowTimeSeconds = nextShowTimeSeconds;
    }
    updateBalls();
    console.log(balls.length);
}

function updateBalls(){

    for( var i = 0 ; i < balls.length ; i ++ ){

        balls[i].x += balls[i].vx;
        balls[i].y += balls[i].vy;
        balls[i].vy += balls[i].g;

        if( balls[i].y >= WINDOW_HEIGHT-RADIUS ){
            balls[i].y = WINDOW_HEIGHT-RADIUS;
            balls[i].vy = - balls[i].vy*0.75;
        }

    }

    var cnt = 0;
    for (var i = 0; i < balls.length; i++) {
        if( balls[i].x + RADIUS > 0 && balls[i].x - RADIUS < WINDOW_WIDTH){
            balls[cnt++] = balls[i];
        }
    }

    while (balls.length > Math.min(300,cnt) ){
        balls.pop();
    }

}

function addBalls( x , y , num ){

    for( var i = 0  ; i < digit[num].length ; i ++ )
        for( var j = 0  ; j < digit[num][i].length ; j ++ )
            if( digit[num][i][j] === 1 ){

                var aBall = {
                    x:x+j*2*(RADIUS+1)+(RADIUS+1),
                    y:y+i*2*(RADIUS+1)+(RADIUS+1),
                    g:1.5+Math.random(),
                    vx:Math.pow( -1 , Math.ceil( Math.random()*1000 ) ) * 4,
                    vy:-5,
                    color: colors[ Math.floor( Math.random()*colors.length ) ]
                }

                balls.push( aBall );
            }
}

function render(ctx) {
    ctx.clearRect(0, 0, WINDOW_WIDTH, WINDOW_HEIGHT);

    var hours = parseInt(curShowTimeSeconds/3600);
    var minutes = parseInt( (curShowTimeSeconds - hours*3600)/60 );
    var seconds = curShowTimeSeconds%60;

    // 绘制小时数
    renderDigit(MARGIN_LEFT, MARGIN_TOP, parseInt(hours/10), ctx);
    renderDigit(MARGIN_LEFT + 15*(RADIUS+1), MARGIN_TOP, parseInt(hours%10), ctx);

    // 绘制冒号
    renderDigit(MARGIN_LEFT + 30*(RADIUS+1), MARGIN_TOP, 10, ctx);

    // 绘制分钟数
    renderDigit(MARGIN_LEFT + 39*(RADIUS+1), MARGIN_TOP, parseInt(minutes/10), ctx);
    renderDigit(MARGIN_LEFT + 54*(RADIUS+1), MARGIN_TOP, parseInt(minutes%10), ctx);

    // 绘制冒号
    renderDigit(MARGIN_LEFT + 69*(RADIUS+1), MARGIN_TOP, 10, ctx);

    // 绘制秒数
    renderDigit(MARGIN_LEFT + 78*(RADIUS+1), MARGIN_TOP, parseInt(seconds/10), ctx);
    renderDigit(MARGIN_LEFT + 93*(RADIUS+1), MARGIN_TOP, parseInt(seconds%10), ctx);

}

function renderDigit(x, y, num, ctx) {
    ctx.fillStyle = 'rgb(0,102,153)';

    for (var i = 0; i < digit[num].length; i++) {
        for (var j = 0; j < digit[num][i].length; j++) {
            if (digit[num][i][j] === 1) {
              draw(x,y,i,j,ctx);
            }
        }
    }

    for( var i = 0 ; i < balls.length ; i ++ ){
        drawBall(i, ctx);
    }
}

function draw(x, y, i, j, ctx) {
    ctx.beginPath();
    ctx.arc(x + j*2*(RADIUS + 1) + (RADIUS + 1), y + i*2*(RADIUS + 1) + (RADIUS + 1), RADIUS, 0, 2*Math.PI);
    ctx.closePath();

    ctx.fill();
}

function drawBall(i, ctx) {
    ctx.fillStyle=balls[i].color;

    ctx.beginPath();
    ctx.arc( balls[i].x , balls[i].y , RADIUS , 0 , 2*Math.PI , true );
    ctx.closePath();

    ctx.fill();
}
```
{% endfold %}
